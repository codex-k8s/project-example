# Модели данных в project-example

В проекте реализована минимальная схема БД для простого общего чата.
Все модели описаны в Django‑приложении `chat` (`services/django_backend/chat/models.py`)
и проецируются на PostgreSQL.

## База данных

Используется одна БД `chat` (см. `deploy/configmap.yaml`, `deploy/secret.yaml`).

Основные таблицы:

- `chat_user` — пользователи чата;
- `chat_message` — сообщения в общем чате.

## Модель `ChatUser` (`chat_user`)

Определение (упрощённо):

- `id` (`bigserial`, PK);
- `nickname` (`varchar(64)`, `UNIQUE`, индекс):
  - уникальный ник пользователя;
  - используется для логина и отображения в интерфейсе;
- `password_hash` (`varchar(128)`):
  - хеш пароля, генерируется Go‑сервисом `chat_backend`
    с помощью `bcrypt`;
- `created_at` (`timestamptz`, `DEFAULT now()`):
  - время регистрации.

Семантика:

- Django‑админка позволяет просматривать/редактировать записи
  (для отладки и демонстрации);
- непосредственная аутентификация пользователей и проверка паролей
  реализована только в Go‑сервисе.

## Модель `Message` (`chat_message`)

Определение (упрощённо):

- `id` (`bigserial`, PK);
- `user_id` (`bigint`, FK → `chat_user.id`, `ON DELETE CASCADE`);
- `text` (`text`):
  - текст сообщения (ограничение на длину на стороне API);
- `created_at` (`timestamptz`, индекс):
  - время отправки сообщения.

Семантика:

- сообщения принадлежат одному пользователю;
- Go‑сервис `chat_backend` добавляет записи через SQL,
  Django‑админка позволяет их просматривать.

## Связь Django и Go

- Django отвечает за описание схемы и миграций (модели + миграция `0001_initial`);
- Go‑сервис `chat_backend` работает напрямую с таблицами:
  - регистрация пользователя — `INSERT INTO chat_user ...`;
  - логин — `SELECT id, password_hash FROM chat_user ...`;
  - отправка и чтение сообщений — операции с `chat_message` и join по `chat_user`.

При изменении моделей:

1. Обновляйте Django‑модели и миграции;
2. Синхронизируйте SQL‑запросы в Go‑сервисе;
3. Обновляйте этот файл (`docs/models.md`).

