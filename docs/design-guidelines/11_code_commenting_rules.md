# Правила комментирования кода в Go

Данный раздел описывает обязательные и рекомендуемые правила комментирования Go-кода, которым должен следовать как 
разработчик, так и ИИ-агент при генерации или модификации кода. Цель — обеспечить читаемость, предсказуемость и 
удобство навигации по коду без избыточных или формальных комментариев.

## Общие принципы

- Комментарии пишутся **на английском языке**, если код не является публичной библиотекой с внешними пользователями.
- Комментарий должен **объяснять намерение и смысл**, а не повторять очевидное из кода.
- Если код можно понять без комментария — комментарий не нужен.
- Если код нельзя понять без комментария — комментарий обязателен.
- Комментарии должны оставаться актуальными. Устаревший комментарий хуже, чем его отсутствие.

## Комментарии к пакетам (package comment)

Каждый пакет **обязан** иметь package comment, если:
- пакет экспортирует типы, функции или переменные;
- пакет является частью публичного API сервиса;
- пакет содержит доменную или инфраструктурную логику.

Требования:
- Комментарий размещается в файле `doc.go` или в начале одного из файлов пакета.
- Комментарий **начинается с имени пакета**.
- Комментарий описывает **назначение пакета и его ответственность**, а не внутреннюю реализацию.

Пример:
```go
// Package user implements domain logic related to users:
// registration, authentication, profile management.
package user
````

Недопустимо:

* Отсутствие package comment в экспортируемом пакете.
* Комментарии вида: `// Package user`.

## Комментарии к экспортируемым типам

Все экспортируемые:

* структуры,
* интерфейсы,
* типы (type alias, enum-подобные конструкции)

**обязаны** иметь комментарий.

Требования:

* Комментарий начинается с имени типа.
* Описывает **роль типа**, а не перечисление полей.
* Не дублирует название типа словами.

Пример:

```go
// User represents a registered system user in the domain model.
type User struct {
	ID    int64
	Email string
}
```

Недопустимо:

```go
// User is a user.
type User struct { ... }
```

## Комментарии к экспортируемым полям структур

Экспортируемые поля структуры **обязаны** иметь комментарий, если:

* их назначение не очевидно из имени;
* поле участвует в бизнес-логике или контракте;
* поле используется во внешних API (HTTP, gRPC, events).

Требования:

* Комментарий должен объяснять **семантику поля**, допустимые значения и ограничения.
* Для технических DTO (request/response) допускается более краткое описание.

Пример:

```go
type CreateUserInput struct {
	// Email is the user's unique login identifier.
	Email string

	// Age must be >= 18 to pass business validation.
	Age int
}
```

Допустимо не комментировать:

* очевидные технические поля (`ID`, `CreatedAt`), если они типовые и однозначные.

## Комментарии к экспортируемым функциям и методам

Все экспортируемые функции и методы **обязаны** иметь комментарий.

Требования:

* Комментарий начинается с имени функции.
* Описывает **что делает функция**, а не как.
* При необходимости указывает:

    * побочные эффекты;
    * важные ограничения;
    * ошибки высокого уровня (семантически, не перечисляя типы).

Пример:

```go
// GetUser returns a user by id or a domain NotFound error if the user does not exist.
func (s *Service) GetUser(ctx context.Context, id int64) (User, error) {
	...
}
```

Недопустимо:

* Комментарии, повторяющие сигнатуру.
* Описание внутренних шагов реализации.

## Комментарии к неэкспортируемому, но сложному коду

Комментарии **обязательны** для:

* нетривиальных алгоритмов;
* сложной бизнес-логики;
* неочевидных условий;
* оптимизаций, завязанных на контекст или ограничения.

Требования:

* Комментарий должен объяснять **почему код устроен именно так**.
* Особенно важно фиксировать:

    * бизнес-инварианты;
    * причины выбора алгоритма;
    * последствия изменения логики.

Пример:

```go
// We intentionally do not return an error here.
// A missing cache entry is an expected scenario and should
// not break the request processing.
item, ok := cache.Get(key)
if !ok {
	return fallbackValue()
}
```

## Inline-комментарии (внутри функций)

Допустимы и рекомендуются, если:

* логика читается не линейно;
* есть несколько веток с разным смыслом;
* код реализует договорённость, не выраженную типами.

Запрещено:

* комментировать каждую строку;
* использовать комментарии вместо понятных имён переменных.

## TODO и FIXME

* `TODO` допускается **только** с указанием причины и (желательно) ссылки на задачу.
* `FIXME` используется только для явно временного или некорректного решения.

Пример:

```go
// TODO: remove this workaround after migration to v2 API (PROJ-123)
```

## Комментарии и архитектурные решения

Если код реализует:

* исключение из стандартов;
* нетривиальный архитектурный компромисс;
* временное решение,

то это **обязательно** фиксируется комментарием рядом с кодом.

Пример:

```go
// This local logging is intentional.
// We apply a fallback here and the error is no longer part of the request contract.
log.Warn("cache unavailable, using db fallback", "err", err)
```

## Чего делать нельзя

Запрещено:

* использовать комментарии как замену плохим именам;
* оставлять комментарии «на всякий случай»;
* писать комментарии, не соответствующие текущему поведению кода;
* копировать комментарии между разными сущностями без адаптации.

## Краткий чек-лист

Перед коммитом убедись, что:

* у каждого экспортируемого пакета есть package comment;
* у всех экспортируемых типов, функций и методов есть комментарии;
* сложная логика объяснена комментариями;
* комментарии объясняют *зачем*, а не *что*;
* нет устаревших или вводящих в заблуждение комментариев.
