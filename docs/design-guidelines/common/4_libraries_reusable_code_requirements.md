# Библиотеки: требования к выносу переиспользуемого кода

Когда выносить в `libs/`:
- нужно минимум в 2 сервисах (повторение уже есть/неизбежно);
- нужен единый стандарт поведения (логирование/метрики/otel/клиенты);
- контракт и поведение должны быть одинаковыми по системе.

Когда НЕ выносить:
- специфично для одного сервиса/домена;
- API “сырой” и будет постоянно ломаться;
- получается “бог-утилита” без чёткой ответственности.

Правила:
- библиотека должна иметь:
    - чёткое назначение,
    - минимальный публичный API,
    - README (контракты + минимальные примеры),
    - правила ошибок и совместимость версий.

## Библиотеки: проектирование и зависимости

Правила:
- Не “утаскивать” фреймворки внутрь бизнес-логики без необходимости.
- Публичный API минимален и стабилен.
- Зависимости осознанные: не тащить тяжёлое ради мелочи; не затягивать инфраструктурные SDK в доменные библиотеки.

Рекомендации:
- выделяйте библиотеки по категориям:
    - `libs/go/observability/*` (логгер/метрики/otel),
    - `libs/go/transport/*` (http/grpc middlewares),
    - `libs/go/storage/*` (postgres helpers, миграции),
    - `libs/go/mq/*` (rabbitmq publisher/consumer utils),
    - `libs/go/cache/*` (redis cache helpers).

## Библиотеки: совместимость и изменение API

Правила:
- По умолчанию изменения обратно совместимы.
- Breaking change допускается только с планом миграции; по возможности — временная поддержка old+new; зафиксировать в changelog/ADR, создать Issue на миграцию.

Примечание:
- Правила Protobuf/gRPC контрактов находятся в `docs/design-guidelines/go/4_protobuf_grpc_contracts.md`.

## Структура `libs/` (общая)

Назначение: в `libs/*` выносим только то, что реально переиспользуется и должно вести себя одинаково в разных сервисах/приложениях.

Рекомендуемые папки:
- `libs/go/*` — общие Go библиотеки.
- `libs/vue/*` — общие Vue-части (SFC-компоненты, composables, плагины, Pinia-plugins).
- `libs/ts/*` — общие TS-утилиты без привязки к Vue (типы, helpers, runtime-валидация, http-клиенты, i18n helpers).
- `libs/js/*` — только если по причинам совместимости нужен JS; по умолчанию предпочтителен `libs/ts/*`.

Запрещено:
- класть в `libs/*` бизнес-логику конкретного домена/продукта;
- тащить тяжёлые зависимости ради “пары функций”;
- делать “god-lib” без чёткой ответственности и владельца.

## Что можно/нужно выносить для фронта в `libs/{vue|ts|js}`

`libs/vue/*` (Vue-специфичное):
- переиспользуемые UI-компоненты (без продуктовых текстов/доменной логики);
- composables (`useX`) общего назначения (debounce, resize observer, clipboard, etc);
- обёртки над `vue-router`, `vue-i18n`, `vue3-cookies` (адаптеры/помощники);
- общие pinia-plugins, базовые store helpers.

`libs/ts/*` (framework-agnostic):
- общие типы/DTO (не доменные модели отдельных приложений), ошибки/результаты (`Result`, `Either`), утилиты;
- общий HTTP слой (обёртка над `axios`: создание клиента, интерсепторы, нормализация ошибок);
- helpers для работы со временем/строками/URL/query params;
- runtime-валидация/парсинг входных данных (если используется) и безопасные “кастеры”.

`libs/js/*`:
- только небольшой слой совместимости или legacy код, который нельзя перевести на TS без больших затрат прямо сейчас.
